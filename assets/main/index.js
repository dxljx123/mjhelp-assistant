window.__require=function t(n,e,o){function i(a,s){if(!e[a]){if(!n[a]){var u=a.split("/");if(u=u[u.length-1],!n[u]){var c="function"==typeof __require&&__require;if(!s&&c)return c(u,!0);if(r)return r(u,!0);throw new Error("Cannot find module '"+a+"'")}a=u}var h=e[a]={exports:{}};n[a][0].call(h.exports,function(t){return i(n[a][1][t]||t)},h,h.exports,t,n,e,o)}return e[a].exports}for(var r="function"==typeof __require&&__require,a=0;a<o.length;a++)i(o[a]);return i}({MJHu:[function(t,n,e){"use strict";cc._RF.push(n,"8a867KtGwlLi5rtdOaTxSjv","MJHu");var o,i=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(t,n)},function(t,n){function e(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}),r=this&&this.__decorate||function(t,n,e,o){var i,r=arguments.length,a=r<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,e):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,n,e,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(r<3?i(a):r>3?i(n,e,a):i(n,e))||a);return r>3&&a&&Object.defineProperty(n,e,a),a};Object.defineProperty(e,"__esModule",{value:!0});var a=t("./MJManager"),s=cc._decorator,u=s.ccclass,c=s.property,h=function(t){function n(){var n,e,o=null!==t&&t.apply(this,arguments)||this;return o.tiaoBox=null,o.wanBox=null,o.tongBox=null,o.mjHandBox=null,o.mjPengGangBox=null,o.pengBtn=null,o.gangBtn=null,o.clearBtn=null,o.tingInfo=null,o.cardNum=null,o.mjAtlas=null,o.nodeOriginalScaleMap=new Map,o.isWaitingForPeng=!1,o.isWaitingForGang=!1,o.suitNameMap=((n={})[a.MJType.TIAO]="bamboo",n[a.MJType.WAN]="character",n[a.MJType.TONG]="dot",n),o.suitChineseMap=((e={})[a.MJType.TIAO]="\u6761",e[a.MJType.WAN]="\u4e07",e[a.MJType.TONG]="\u7b52",e),o}var e;return i(n,t),e=n,n.prototype.start=function(){if(cc.view.setDesignResolutionSize(1280,720,cc.ResolutionPolicy.SHOW_ALL),cc.view.setOrientation(cc.macro.ORIENTATION_LANDSCAPE),this.mjPengGangBox){this.mjPengGangBox.setAnchorPoint(.5,.5);var t=this.mjPengGangBox.y||0;this.mjPengGangBox.setPosition(0,t),this.initBottomMj(),this.initBtn(),this.initInfo()}else console.error("mjPengGangBox \u672a\u521d\u59cb\u5316\uff0c\u8bf7\u68c0\u67e5\u573a\u666f\u4e2d\u7684\u8282\u70b9\u5f15\u7528")},n.prototype.initInfo=function(){var t=this.tingInfo,n=this.cardNum;t&&(t.string=""),n&&(n.string="",n.node.color=cc.Color.WHITE)},n.prototype.initBottomMj=function(){var t=this,n=this.tiaoBox,e=this.wanBox,o=this.tongBox;n&&e&&o?cc.resources.load("Z_my",cc.SpriteAtlas,function(i,r){!i&&r?(t.mjAtlas=r,t.setMjSprites(n,e,o,9,r)):console.error("\u52a0\u8f7d\u56fe\u96c6\u5931\u8d25:",i)}):console.error("\u5e95\u90e8\u724c\u5806\u8282\u70b9\u672a\u521d\u59cb\u5316\uff0c\u8bf7\u68c0\u67e5\u573a\u666f\u4e2d\u7684\u8282\u70b9\u5f15\u7528")},n.prototype.initBtn=function(){this.bindPressEffect(this.pengBtn,this.clickPengBtn,this),this.bindPressEffect(this.gangBtn,this.clickGangBtn,this),this.bindPressEffect(this.clearBtn,this.clickClearBtn,this)},n.prototype.bindPressEffect=function(t,n,o){this.nodeOriginalScaleMap.has(t)||this.nodeOriginalScaleMap.set(t,t.scale);var i=this.nodeOriginalScaleMap.get(t),r=t.getComponent(cc.Button);r&&(r.zoomScale=1);var a=i*e.PRESS_SCALE;t.on(cc.Node.EventType.TOUCH_START,function(){t.stopAllActions(),cc.tween(t).to(.1,{scale:a},{easing:"sineOut"}).start()},this),t.on(cc.Node.EventType.TOUCH_MOVE,function(){Math.abs(t.scale-a)>.01&&(t.stopAllActions(),cc.tween(t).to(.1,{scale:a},{easing:"sineOut"}).start())},this),t.on(cc.Node.EventType.TOUCH_END,function(){t.stopAllActions(),o?n.call(o,t):n(t),cc.tween(t).to(.1,{scale:i},{easing:"sineOut"}).start()},this),t.on(cc.Node.EventType.TOUCH_CANCEL,function(){t.stopAllActions(),cc.tween(t).to(.1,{scale:i},{easing:"sineOut"}).start()},this)},n.prototype.setMjSprites=function(t,n,e,o,i){var r=this;if(t&&n&&e&&i)for(var s=[{box:t,type:a.MJType.TIAO},{box:n,type:a.MJType.WAN},{box:e,type:a.MJType.TONG}],u=function(t){s.forEach(function(n){var e=n.box,o=n.type,a=e.getChildByName("mj_"+t);if(a){var s="M_"+r.suitNameMap[o]+"_"+t,u=i.getSpriteFrame(s);u&&(a.getComponent(cc.Sprite).spriteFrame=u,r.bindPressEffect(a,function(){return r.onClickMj(o,t)},r))}})},c=1;c<=o;c++)u(c);else console.error("setMjSprites: \u8282\u70b9\u6216\u56fe\u96c6\u672a\u521d\u59cb\u5316")},n.prototype.onClickMj=function(t,n){if(this.isWaitingForPeng)this.doPeng(t,n,!1);else if(this.isWaitingForGang)this.doGang(t,n,!1);else{switch(t){case a.MJType.TIAO:console.log("\u70b9\u4e86",n,"\u6761");break;case a.MJType.WAN:console.log("\u70b9\u4e86",n,"\u4e07");break;case a.MJType.TONG:console.log("\u70b9\u4e86",n,"\u7b52")}this.putMjToHand(t,n)}},n.prototype.getMjFrameName=function(t,n){return"M_"+this.suitNameMap[t]+"_"+n},n.prototype.parseMjNodeName=function(t){var n=t.match(/mj_(\d+)_(\d+)/);return n?{type:parseInt(n[1]),num:parseInt(n[2])}:null},n.prototype.sortHandBox=function(){var t=this,n=this.mjHandBox.children.slice();n.sort(function(n,e){var o=t.parseMjNodeName(n.name),i=t.parseMjNodeName(e.name);return o&&i?o.type!==i.type?o.type-i.type:o.num-i.num:0}),n.forEach(function(t,n){t.setSiblingIndex(n)})},n.prototype.putMjToHand=function(t,n){var e=this;if(this.mjAtlas)if(a.default.getInstance().validateAddTile(this.mjHandBox,this.mjPengGangBox,t,n)){var o=this.getMjFrameName(t,n),i=this.mjAtlas.getSpriteFrame(o);if(i){var r=new cc.Node;r.name="mj_"+t+"_"+n,r.addComponent(cc.Sprite).spriteFrame=i,this.bindPressEffect(r,function(){return e.onClickHandMj(t,n)},this),this.mjHandBox.addChild(r),this.sortHandBox(),this.checkGameState()}else console.error("\u672a\u627e\u5230\u8d44\u6e90: "+o)}else console.warn("\u65e0\u6cd5\u6dfb\u52a0\u724c: "+t+"_"+n+"\uff0c\u53ef\u80fd\u8d85\u8fc7\u6700\u5927\u6570\u91cf\u9650\u5236");else console.error("\u56fe\u96c6\u672a\u52a0\u8f7d")},n.prototype.updateCardNum=function(){var t=a.default.getInstance().countTiles(this.mjHandBox,this.mjPengGangBox);this.cardNum.string=t.totalCount.toString()},n.prototype.checkGameState=function(){var t=a.default.getInstance().countTiles(this.mjHandBox,this.mjPengGangBox);if(this.updateCardNum(),!t.isValid)return console.warn("\u724c\u6570\u65e0\u6548:",t),void(this.tingInfo.string="");"ting"===t.mode?(console.log("\u8fdb\u5165\u542c\u724c\u6a21\u5f0f\uff0813\u5f20\uff09"),this.calculateAndDisplayTing()):"da"===t.mode?(console.log("\u8fdb\u5165\u6253\u724c\u6a21\u5f0f\uff0814\u5f20\uff09"),this.calculateAndDisplayDiscardRecommendation()):this.tingInfo.string=""},n.prototype.calculateAndDisplayTing=function(){var t=this,n=a.default.getInstance().calculateTing(this.mjHandBox,this.mjPengGangBox);if(0!==n.length){n.sort(function(t,n){return t.score!==n.score?n.score-t.score:t.type!==n.type?t.type-n.type:t.num-n.num});var e=new Map;n.forEach(function(t){var n=t.type+"_"+t.num,o=e.get(n);(!o||t.score>o.score||t.score===o.score&&t.remainingCount>o.remainingCount)&&e.set(n,t)});var o=Array.from(e.values());o.sort(function(t,n){return t.score!==n.score?n.score-t.score:t.type!==n.type?t.type-n.type:t.num-n.num});var i=new Map;o.forEach(function(t){i.has(t.score)||i.set(t.score,[]),i.get(t.score).push(t)});var r="\u542c\uff1a",s=Array.from(i.keys()).sort(function(t,n){return n-t});s.forEach(function(n,e){var o=i.get(n),a=o[0].pattern;o.sort(function(t,n){return t.remainingCount!==n.remainingCount?n.remainingCount-t.remainingCount:t.type!==n.type?t.type-n.type:t.num-n.num});var u=o.length>0?o[0].remainingCount:0;o.forEach(function(n,e){var i=t.suitChineseMap[n.type],a=t.getNumberName(n.num);r+=""+a+i,n.remainingCount===u&&u>0&&(r+="(\u591a)"),e<o.length-1&&(r+=" ")}),r+="("+n+"\u5206)",a&&a.trim()&&(r+=" <"+a+">"),e<s.length-1&&(r+="; ")}),this.tingInfo.string=r}else this.tingInfo.string="<color=#BDBDBD>\u542c\uff1a\u65e0</color>"},n.prototype.calculateAndDisplayDiscardRecommendation=function(){var t=this,n=a.default.getInstance(),e=n.countTiles(this.mjHandBox,this.mjPengGangBox);if(14===e.totalCount&&e.isValid&&n.canWin(e.tileCountMap,this.mjHandBox,this.mjPengGangBox)){var o=n.calculateFan(e.tileCountMap,this.mjHandBox,this.mjPengGangBox);if(o.length>0){o.sort(function(t,n){return n.fan-t.fan});var i=o[0],r="<color=#FFC107>\u80e1\u724c\uff01\uff01("+i.fan+"\u5206)<"+i.pattern+"></color>",s=n.calculateDiscardRecommendation(this.mjHandBox,this.mjPengGangBox);if(s.length>0){var u=[],c=[];if(s.forEach(function(t){t.tingCount>0?u.push(t):c.push(t)}),u.length>0){var h=u[0],g=this.suitChineseMap[h.type],l=this.getNumberName(h.num);if(P=this.createTestHandBoxForDiscard(h.type,h.num)){var p=n.calculateTing(P,this.mjPengGangBox);if(P.destroy(),p.length>0){var f=new Map;p.forEach(function(t){var n=t.score;f.has(n)||f.set(n,[]),f.get(n).push(t)});var d=Array.from(f.keys()).sort(function(t,n){return n-t}),m="";if(d.forEach(function(n,e){var o=f.get(n);o.sort(function(t,n){return t.type!==n.type?t.type-n.type:t.num-n.num});var i=[];o.forEach(function(e){var o=t.suitChineseMap[e.type],r=t.getNumberName(e.num);i.push(""+r+o+"("+n+"\u5206)")}),m+=i.join(" "),o.length>0&&o[0].pattern&&(m+=" <"+o[0].pattern+">"),e<d.length-1&&(m+=" ")}),r+=" <color=#FFCC80>\u6253:"+l+g+" \u80e1:"+m+"</color>",c.length>0){var v=c[0],y=this.suitChineseMap[v.type];r+=" <color=#FFB74D>\u6253:"+(T=this.getNumberName(v.num))+y+" \u56e0\u4e3a\uff1a"+(C=this.getNoTingAdvantage(v))+"</color>"}}}}else if(c.length>0&&(h=c[0],g=this.suitChineseMap[h.type],l=this.getNumberName(h.num),P=this.createTestHandBoxForDiscard(h.type,h.num))){var j=this.getNoTingReason(P,h.type,h.num);P.destroy(),r+=" <color=#FFB74D>\u6253:"+l+g+" \u56e0\u4e3a\uff1a"+j+"</color>"}}return void(this.tingInfo.string=r)}}var M=n.calculateDiscardRecommendation(this.mjHandBox,this.mjPengGangBox);if(0!==M.length){var G=[],B=[];if(M.forEach(function(t){t.tingCount>0?G.push(t):B.push(t)}),G.length>0){if(h=G[0],g=this.suitChineseMap[h.type],l=this.getNumberName(h.num),!(P=this.createTestHandBoxForDiscard(h.type,h.num)))return void(this.tingInfo.string="\u6253:"+l+g+" \u56e0\u4e3a\uff1a\u65e0\u6cd5\u521b\u5efa\u6d4b\u8bd5\u624b\u724c");if(p=n.calculateTing(P,this.mjPengGangBox),P.destroy(),0===p.length)return j=this.getNoTingReason(P,h.type,h.num),void(this.tingInfo.string="<color=#FFB74D>\u6253:"+l+g+" \u56e0\u4e3a\uff1a"+j+"</color>");var _=new Map;p.forEach(function(t){var n=t.score;_.has(n)||_.set(n,[]),_.get(n).push(t)});var x=Array.from(_.keys()).sort(function(t,n){return n-t}),N="";if(x.forEach(function(n,e){var o=_.get(n);o.sort(function(t,n){return t.type!==n.type?t.type-n.type:t.num-n.num});var i=[];o.forEach(function(e){var o=t.suitChineseMap[e.type],r=t.getNumberName(e.num);i.push(""+r+o+"("+n+"\u5206)")}),N+=i.join(" "),o.length>0&&o[0].pattern&&(N+=" <"+o[0].pattern+">"),e<x.length-1&&(N+=" ")}),B.length>0){v=B[0],y=this.suitChineseMap[v.type];var T=this.getNumberName(v.num),C=this.getNoTingAdvantage(v);this.tingInfo.string="<color=#FFCC80>\u6253:"+l+g+" \u80e1:"+N+"</color> <color=#FFB74D>\u6253:"+T+y+" \u56e0\u4e3a\uff1a"+C+"</color>"}else this.tingInfo.string="<color=#FFCC80>\u6253:"+l+g+" \u80e1:"+N+"</color>"}else{var P;if(B.length>0)return h=B[0],g=this.suitChineseMap[h.type],l=this.getNumberName(h.num),(P=this.createTestHandBoxForDiscard(h.type,h.num))?(j=this.getNoTingReason(P,h.type,h.num),P.destroy(),void(this.tingInfo.string="<color=#FFB74D>\u6253:"+l+g+" \u56e0\u4e3a\uff1a"+j+"</color>")):void(this.tingInfo.string="<color=#E57373>\u6253:"+l+g+" \u56e0\u4e3a\uff1a\u65e0\u6cd5\u521b\u5efa\u6d4b\u8bd5\u624b\u724c</color>");this.tingInfo.string="<color=#BDBDBD>\u63a8\u8350\uff1a\u65e0</color>"}}else this.tingInfo.string="<color=#BDBDBD>\u63a8\u8350\uff1a\u65e0</color>"},n.prototype.getNoTingAdvantage=function(t){var n=this,e=[],o=this.createTestHandBoxForDiscard(t.type,t.num);if(!o)return"\u65e0\u6cd5\u5206\u6790";for(var i=a.default.getInstance(),r=i.countTiles(o,this.mjPengGangBox),s=o.children,u=new Map,c=0;c<s.length;c++)if((_=s[c])&&!1!==_.isValid){var h=this.parseMjNodeName(_.name);if(h){var g=h.type+"_"+h.num;u.set(g,(u.get(g)||0)+1)}}var l=new Set;if(u.forEach(function(t,n){if(t>0){var e=n.split("_")[0],o=parseInt(e);l.add(o)}}),1===l.size){var p=Array.from(l)[0],f=this.suitChineseMap[p];e.push(f+"\u6e05\u4e00\u8272\u6982\u7387\u5927")}var d=0,m=0;u.forEach(function(t){2===t?d++:1===t&&m++}),d>=5&&e.push("\u4e03\u5c0f\u5bf9\u6982\u7387\u5927");var v=0;u.forEach(function(t){t>=3&&v++}),v>=3&&e.push("\u5927\u5bf9\u80e1\u6982\u7387\u5927");for(var y=0,j=0;j<3;j++)for(var M=1;M<=9;M++){g=j+"_"+M;var G=r.tileCountMap.get(g)||0;if(!(G>=4)){new Map(r.tileCountMap).set(g,G+1);var B=new cc.Node;for(B.name="tempHandBox",c=0;c<s.length;c++){var _;if((_=s[c])&&!1!==_.isValid){var x=new cc.Node;x.name=_.name,B.addChild(x)}}var N=new cc.Node;N.name="mj_"+j+"_"+M,B.addChild(N);var T=i.calculateTing(B,this.mjPengGangBox);T.length>y&&(y=T.length),B.destroy()}}y>0&&e.push("\u8fdb\u5f20\u6570\u91cf\u591a\uff08\u6700\u591a"+y+"\u5f20\uff09"),s.length;var C=0,P=0;if(u.forEach(function(t,n){if(2===t){var e=n.split("_"),o=e[0],i=e[1],r=parseInt(o);if((g=parseInt(i))>=2&&g<=8){var a=r+"_"+(g-1),s=r+"_"+(g+1),c=u.get(a)||0,h=u.get(s)||0;(c>0||h>0)&&C++}P++}else if(1===t){var g,l=n.split("_");o=l[0],i=l[1],r=parseInt(o),(g=parseInt(i))>=2&&g<=8&&(a=r+"_"+(g-1),s=r+"_"+(g+1),c=u.get(a)||0,h=u.get(s)||0,c>0&&h>0?C++:(c>0||h>0)&&(C+=.5))}}),0===e.length&&(C>0&&e.push("\u53ef\u7ec4\u6210"+Math.floor(C)+"\u4e2a\u987a\u5b50"),P>0&&e.push("\u53ef\u7ec4\u6210"+P+"\u4e2a\u523b\u5b50"),d>0&&e.push("\u6709"+d+"\u4e2a\u5bf9\u5b50"),m>0&&e.push("\u6709"+m+"\u5f20\u5355\u5f20\u53ef\u7ec4\u5408"),0===e.length)){var A=[];l.forEach(function(t){var e=0;if(u.forEach(function(n,o){var i=o.split("_")[0];parseInt(i)===t&&(e+=n)}),e>0){var o=n.suitChineseMap[t];A.push(""+o+e+"\u5f20")}}),A.length>0?e.push("\u724c\u578b\u96c6\u4e2d\uff08"+A.join("\uff0c")+"\uff09"):e.push("\u724c\u578b\u7ed3\u6784\u826f\u597d")}return o.destroy(),e.join(" ")},n.prototype.createTestHandBoxForDiscard=function(t,n){var e=new cc.Node;e.name="testHandBox";for(var o=this.mjHandBox.children,i=!1,r=0;r<o.length;r++){var a=o[r];if(a&&!1!==a.isValid){var s=this.parseMjNodeName(a.name);if(s)if(i||s.type!==t||s.num!==n){var u=new cc.Node;u.name=a.name,e.addChild(u)}else i=!0}}return e},n.prototype.getNoTingReason=function(t){var n=this;if(!t)return"\u65e0\u6cd5\u521b\u5efa\u6d4b\u8bd5\u624b\u724c";var e=a.default.getInstance(),o=e.countTiles(t,this.mjPengGangBox);if(13!==o.totalCount)return"\u6253\u6389\u540e\u53ea\u6709"+o.totalCount+"\u5f20\u724c\uff0c\u9700\u898113\u5f20\u624d\u80fd\u542c\u724c";if(!o.isValid){var i=[];o.tileCountMap.forEach(function(t,e){if(t>4){var o=e.split("_"),r=o[0],a=o[1],s=parseInt(r),u=parseInt(a),c=n.suitChineseMap[s],h=n.getNumberName(u);i.push(""+h+c+"\u6709"+t+"\u5f20\uff08\u8d85\u8fc74\u5f20\uff09")}});var r=new Set;return o.tileCountMap.forEach(function(t,n){if(t>0){var e=n.split("_")[0],o=parseInt(e);r.add(o)}}),r.size>2&&i.push("\u6709"+r.size+"\u79cd\u82b1\u8272\uff08\u8d85\u8fc72\u79cd\uff09"),i.length>0?i.join("\uff1b"):"\u724c\u578b\u65e0\u6548"}for(var s=0,u=[],c=0;c<3;c++)for(var h=1;h<=9;h++){var g=new Map(o.tileCountMap),l=c+"_"+h,p=g.get(l)||0;if(!(p>=4)&&(g.set(l,p+1),e.canWin(g,t,this.mjPengGangBox))){s++;var f=this.suitChineseMap[c],d=this.getNumberName(h);u.push(""+d+f)}}if(0===s){var m=[],v=t.children;if(0===v.length)return"\u624b\u724c\u4e3a\u7a7a";for(var y=new Map,j=0;j<v.length;j++){var M=v[j];if(M&&!1!==M.isValid){var G=this.parseMjNodeName(M.name);G&&(l=G.type+"_"+G.num,y.set(l,(y.get(l)||0)+1))}}var B=0,_=0,x=0;return y.forEach(function(t){1===t?x++:2===t?B++:t>=3&&_++}),x>2&&m.push("\u5355\u5f20\u724c\u8fc7\u591a\uff08"+x+"\u5f20\uff09"),B>1&&m.push("\u5bf9\u5b50\u8fc7\u591a\uff08"+B+"\u4e2a\uff09"),0===B&&0===x&&_>0&&m.push("\u7f3a\u5c11\u5c06\u724c\uff08\u5bf9\u5b50\uff09"),x>0&&0===B&&0===_?"\u624b\u724c\u5168\u662f\u5355\u5f20\uff08"+x+"\u5f20\uff09\uff0c\u65e0\u6cd5\u7ec4\u6210\u6709\u6548\u724c\u578b":B>1&&0===x&&0===_?"\u624b\u724c\u5168\u662f"+B+"\u4e2a\u5bf9\u5b50\uff0c\u65e0\u6cd5\u7ec4\u6210\u6709\u6548\u724c\u578b":m.length>0?m.join("\uff1b"):"\u724c\u578b\u4e0d\u5b8c\u6574\uff08"+x+"\u5f20\u5355\u5f20\uff0c"+B+"\u4e2a\u5bf9\u5b50\uff0c"+_+"\u4e2a\u523b\u5b50/\u6760\uff09"}return"\u672a\u77e5\u539f\u56e0"},n.prototype.getNumberName=function(t){return{1:"\u4e00",2:"\u4e8c",3:"\u4e09",4:"\u56db",5:"\u4e94",6:"\u516d",7:"\u4e03",8:"\u516b",9:"\u4e5d"}[t]||t.toString()},n.prototype.onClickHandMj=function(t,n){this.isWaitingForPeng?this.doPeng(t,n,!0):this.isWaitingForGang?this.doGang(t,n,!0):(this.removeMjFromHand(t,n),console.log("\u79fb\u9664\u4e86\u624b\u724c:",t,n),this.checkGameState())},n.prototype.onClickPengGangMj=function(t){var n=t._mjGroupType,e=t._mjGroupNum,o=t._mjGroupCount;void 0!==n&&void 0!==e&&void 0!==o?(this.removeMjGroupFromPengGang(t,n,e,o),console.log("\u79fb\u9664\u4e86"+o+"\u5f20\u724c\u7ec4:",n,e),this.updatePengGangBoxWidth(),this.centerPengGangBox(),this.checkGameState()):console.warn("\u65e0\u6cd5\u8bc6\u522b\u724c\u7ec4\u4fe1\u606f")},n.prototype.removeMjGroupFromPengGang=function(t,n,e,o){for(var i="mj_"+n+"_"+e,r=this.mjPengGangBox.children,a=-1,s=0;s<r.length;s++)if(r[s]===t){a=s;break}if(-1!==a){for(var u=a;u>0&&r[u-1].name===i;)u--;for(var c=a;c<r.length-1&&r[c+1].name===i;)c++;var h=c-u+1;if(h===o)for(s=c;s>=u;s--)r[s]&&r[s].name===i&&r[s].destroy();else console.warn("\u7ec4\u6570\u91cf\u4e0d\u5339\u914d: \u671f\u671b"+o+"\u5f20\uff0c\u5b9e\u9645"+h+"\u5f20")}},n.prototype.setBtnHighlight=function(t,n){t.opacity=n?150:255},n.prototype.createMjNode=function(t,n){if(!this.mjAtlas)return console.error("\u56fe\u96c6\u672a\u52a0\u8f7d"),null;var e=this.getMjFrameName(t,n),o=this.mjAtlas.getSpriteFrame(e);if(!o)return console.error("\u672a\u627e\u5230\u8d44\u6e90: "+e),null;var i=new cc.Node;return i.name="mj_"+t+"_"+n,i.addComponent(cc.Sprite).spriteFrame=o,i},n.prototype.removeMjFromHand=function(t,n){for(var e="mj_"+t+"_"+n,o=this.mjHandBox.children,i=o.length-1;i>=0;i--){var r=o[i];if(r&&r.name===e){r.removeFromParent(),r.destroy();break}}this.updateCardNum()},n.prototype.removeAllMjFromHand=function(t,n){for(var e="mj_"+t+"_"+n,o=this.mjHandBox.children,i=0,r=o.length-1;r>=0;r--){var a=o[r];a&&a.name===e&&(a.removeFromParent(),a.destroy(),i++)}return i},n.prototype.countMjInHand=function(t,n){for(var e="mj_"+t+"_"+n,o=this.mjHandBox.children,i=0,r=0;r<o.length;r++)o[r].name===e&&i++;return i},n.prototype.restoreMjToHand=function(t,n,e){var o=this;if(this.mjAtlas){var i=this.getMjFrameName(t,n),r=this.mjAtlas.getSpriteFrame(i);if(r){for(var a=0;a<e;a++){var s=new cc.Node;s.name="mj_"+t+"_"+n,s.addComponent(cc.Sprite).spriteFrame=r,this.bindPressEffect(s,function(){return o.onClickHandMj(t,n)},this),this.mjHandBox.addChild(s)}this.sortHandBox()}}},n.prototype.addMjGroupToPengGangBox=function(t,n,o){for(var i=this,r=e.PENG_GANG_SPACING,a=[],s=0;s<o;s++){var u=this.createMjNode(t,n);u&&a.push(u)}if(0!==a.length&&a[0]){var c=a[0].getContentSize().width||50,h=(a[0].getContentSize().height,this.mjPengGangBox.children.length),g=0;if(h>0){var l=0;for(s=0;s<h;s++)l+=this.mjPengGangBox.children[s].getContentSize().width||50;g=l+r}var p=4===o;a.forEach(function(r,a){r.setAnchorPoint(0,0);var s=0,u=0;p&&3===a?(s=g+c,u=-e.GANG_OVERLAP_OFFSET):(s=g+a*c,u=0),r.setPosition(s,u),r._mjGroupType=t,r._mjGroupNum=n,r._mjGroupCount=o,i.bindPressEffect(r,function(t){return i.onClickPengGangMj(t)},i),i.mjPengGangBox.addChild(r)}),this.updatePengGangBoxWidth(),this.centerPengGangBox()}},n.prototype.updatePengGangBoxWidth=function(){if(this.mjPengGangBox){var t=this.mjPengGangBox.children;if(0!==t.length){for(var n=0,e=0;e<t.length;e++){var o=t[e];if(0===o.y){var i=o.getContentSize().width||50,r=o.x+i;r>n&&(n=r)}}if(0!==t.length){var a=t[0].getContentSize().height||70,s=a;for(e=0;e<t.length;e++)t[e].y<0&&(s=Math.max(s,a-t[e].y));this.mjPengGangBox.setContentSize(n,s)}}else{var u=this.mjPengGangBox.getContentSize();this.mjPengGangBox.setContentSize(0,u.height||0)}}else console.warn("mjPengGangBox \u672a\u521d\u59cb\u5316")},n.prototype.centerPengGangBox=function(){if(this.mjPengGangBox){var t=this.mjPengGangBox.children;if(0!==t.length){var n=e.PENG_GANG_SPACING;if(0!==t.length&&t[0]){for(var o=t[0].getContentSize().width||50,i=[],r=null,a=0;a<t.length;a++){var s=t[a];(h=this.parseMjNodeName(s.name))&&(r&&r.type===h.type&&r.num===h.num?r.count++:(r&&i.push(r),r={type:h.type,num:h.num,count:1,startIndex:a}))}r&&i.push(r),i.sort(function(t,n){return t.type!==n.type?t.type-n.type:t.num-n.num});var u=[];i.forEach(function(n){for(var e=0;e<n.count;e++)u.push(t[n.startIndex+e])}),u.forEach(function(t,n){t.setSiblingIndex(n)}),i=[],r=null;var c=this.mjPengGangBox.children;for(a=0;a<c.length;a++){var h;s=c[a],(h=this.parseMjNodeName(s.name))&&(r&&r.type===h.type&&r.num===h.num?r.count++:(r&&i.push(r),r={type:h.type,num:h.num,count:1,startIndex:a}))}r&&i.push(r);var g=0;if(i.forEach(function(t,e){var r=4===t.count?3*o:t.count*o;g+=r,e<i.length-1&&(g+=n)}),0!==c.length&&c[0]){c[0].getContentSize().height;var l=-g/2;i.forEach(function(t,r){for(var a=4===t.count,s=0;s<t.count;s++){var u=c[t.startIndex+s],h=0,g=0;a&&3===s?(h=l+o,g=-e.GANG_OVERLAP_OFFSET):(h=l+s*o,g=0),u.setPosition(h,g)}var p=a?3*o:t.count*o;l+=p,r<i.length-1&&(l+=n)}),this.updatePengGangBoxWidth()}}}}},n.prototype.doPeng=function(t,n,e){this.isWaitingForPeng=!1,this.setBtnHighlight(this.pengBtn,!1);var o=a.default.getInstance();if(e){if(0===this.countMjInHand(t,n))return void console.warn("\u624b\u724c\u4e2d\u6ca1\u6709\u8be5\u724c\uff0c\u65e0\u6cd5\u78b0\u724c");var i=this.removeAllMjFromHand(t,n),r=3-i,s=o.countTiles(this.mjHandBox,this.mjPengGangBox),u=s.totalCount+r,c=t+"_"+n,h=(s.tileCountMap.get(c)||0)+r;if(u>14)return console.warn("\u78b0\u724c\u540e\u603b\u5f20\u6570\u8d85\u8fc714\u5f20\uff0c\u65e0\u6cd5\u78b0\u724c"),void this.restoreMjToHand(t,n,i);if(h>4)return console.warn("\u78b0\u724c\u540e"+t+"_"+n+"\u7684\u6570\u91cf\u8d85\u8fc74\u5f20\uff0c\u65e0\u6cd5\u78b0\u724c"),void this.restoreMjToHand(t,n,i);var g=o.getExistingSuits(this.mjHandBox,this.mjPengGangBox);if(!g.has(t)&&g.size>=2)return console.warn("\u78b0\u724c\u540e\u82b1\u8272\u8d85\u8fc7\u4e24\u79cd\uff0c\u65e0\u6cd5\u78b0\u724c"),void this.restoreMjToHand(t,n,i);this.addMjGroupToPengGangBox(t,n,3),console.log("\u78b0\u724c\u6210\u529f: "+t+"_"+n+" (\u4ece\u624b\u724c\u79fb\u9664"+i+"\u5f20\uff0c\u6dfb\u52a0"+r+"\u5f20)")}else{if(!o.validateAddTiles(this.mjHandBox,this.mjPengGangBox,t,n,3,!1))return void console.warn("\u78b0\u724c\u9a8c\u8bc1\u5931\u8d25\uff1a\u53ef\u80fd\u8d85\u8fc7\u6570\u91cf\u9650\u5236\u6216\u82b1\u8272\u9650\u5236");this.addMjGroupToPengGangBox(t,n,3),console.log("\u78b0\u724c\u6210\u529f:",t,n,"(\u4ece\u724c\u5806)")}this.checkGameState()},n.prototype.findPengGangGroup=function(t,n){for(var e=this.mjPengGangBox.children,o=0;o<e.length;o++){var i=e[o],r=i._mjGroupType,a=i._mjGroupNum,s=i._mjGroupCount;if(r===t&&a===n)return{exists:!0,isGang:4===s,count:s||0}}return null},n.prototype.upgradePengToGang=function(t,n){for(var o=this,i=this.mjPengGangBox.children,r=[],a=0;a<i.length;a++){var s=i[a],u=s._mjGroupType,c=s._mjGroupNum;u===t&&c===n&&r.push(s)}if(3===r.length){var h=this.createMjNode(t,n);h&&r[0]&&(r[0].getContentSize().width,r[0].getContentSize().height,h.setAnchorPoint(0,0),h.setPosition(r[1].x,-e.GANG_OVERLAP_OFFSET),r.forEach(function(t){t._mjGroupCount=4}),h._mjGroupType=t,h._mjGroupNum=n,h._mjGroupCount=4,this.bindPressEffect(h,function(t){return o.onClickPengGangMj(t)},this),this.mjPengGangBox.addChild(h),this.updatePengGangBoxWidth(),this.centerPengGangBox())}else console.warn("\u78b0\u6760\u533a"+t+"_"+n+"\u7684\u724c\u6570\u4e0d\u662f3\u5f20\uff0c\u65e0\u6cd5\u5347\u7ea7\u4e3a\u6760")},n.prototype.doGang=function(t,n,e){this.isWaitingForGang=!1,this.setBtnHighlight(this.gangBtn,!1);var o=a.default.getInstance(),i=this.findPengGangGroup(t,n);if(i&&i.exists){if(i.isGang)return void console.warn("\u78b0\u6760\u533a"+t+"_"+n+"\u5df2\u7ecf\u662f\u6760\uff0c\u65e0\u6cd5\u518d\u6b21\u6760\u724c");if(3===i.count)if(e){if(0===this.countMjInHand(t,n))return void console.warn("\u624b\u724c\u4e2d\u6ca1\u6709\u8be5\u724c\uff0c\u65e0\u6cd5\u6760\u724c");var r=this.removeAllMjFromHand(t,n),s=(m=o.countTiles(this.mjHandBox,this.mjPengGangBox)).totalCount,u=t+"_"+n,c=(m.tileCountMap.get(u)||0)+1;if(s>14)return console.warn("\u6760\u724c\u540e\u603b\u5f20\u6570\u8d85\u8fc714\u5f20\uff0c\u65e0\u6cd5\u6760\u724c"),void this.restoreMjToHand(t,n,r);if(c>4)return console.warn("\u6760\u724c\u540e"+t+"_"+n+"\u7684\u6570\u91cf\u8d85\u8fc74\u5f20\uff0c\u65e0\u6cd5\u6760\u724c"),void this.restoreMjToHand(t,n,r);this.upgradePengToGang(t,n),console.log("\u6760\u724c\u6210\u529f: "+t+"_"+n+" (\u4ece\u624b\u724c\u79fb\u9664"+r+"\u5f20\uff0c\u5c06\u78b0\u5347\u7ea7\u4e3a\u6760)")}else{if(u=t+"_"+n,(c=((m=o.countTiles(this.mjHandBox,this.mjPengGangBox)).tileCountMap.get(u)||0)+1)>4)return void console.warn("\u6760\u724c\u540e"+t+"_"+n+"\u7684\u6570\u91cf\u8d85\u8fc74\u5f20\uff0c\u65e0\u6cd5\u6760\u724c");if(m.totalCount>14)return void console.warn("\u6760\u724c\u540e\u603b\u5f20\u6570\u8d85\u8fc714\u5f20\uff0c\u65e0\u6cd5\u6760\u724c");if(!(M=o.getExistingSuits(this.mjHandBox,this.mjPengGangBox)).has(t)&&M.size>=2)return void console.warn("\u6760\u724c\u540e\u82b1\u8272\u8d85\u8fc7\u4e24\u79cd\uff0c\u65e0\u6cd5\u6760\u724c");this.upgradePengToGang(t,n),console.log("\u6760\u724c\u6210\u529f: "+t+"_"+n+" (\u4ece\u724c\u5806\u6dfb\u52a01\u5f20\uff0c\u5c06\u78b0\u5347\u7ea7\u4e3a\u6760)")}}else if(e){if(0===this.countMjInHand(t,n))return void console.warn("\u624b\u724c\u4e2d\u6ca1\u6709\u8be5\u724c\uff0c\u65e0\u6cd5\u6760\u724c");r=this.removeAllMjFromHand(t,n),s=(m=o.countTiles(this.mjHandBox,this.mjPengGangBox)).totalCount+4,u=t+"_"+n;var h=(m.tileCountMap.get(u)||0)+4;if(s>14)return console.warn("\u6760\u724c\u540e\u603b\u5f20\u6570\u8d85\u8fc714\u5f20\uff0c\u65e0\u6cd5\u6760\u724c"),void this.restoreMjToHand(t,n,r);if(h>4)return console.warn("\u6760\u724c\u540e"+t+"_"+n+"\u7684\u6570\u91cf\u8d85\u8fc74\u5f20\uff0c\u65e0\u6cd5\u6760\u724c"),void this.restoreMjToHand(t,n,r);if(!(M=o.getExistingSuits(this.mjHandBox,this.mjPengGangBox)).has(t)&&M.size>=2)return console.warn("\u6760\u724c\u540e\u82b1\u8272\u8d85\u8fc7\u4e24\u79cd\uff0c\u65e0\u6cd5\u6760\u724c"),void this.restoreMjToHand(t,n,r);this.addMjGroupToPengGangBox(t,n,4),console.log("\u6760\u724c\u6210\u529f: "+t+"_"+n+" (\u4ece\u624b\u724c\u79fb\u9664"+r+"\u5f20\uff0c\u5728\u78b0\u6760\u533a\u6dfb\u52a04\u5f20)")}else if(this.countMjInHand(t,n)>0){r=this.removeAllMjFromHand(t,n),console.log("\u79fb\u9664\u624b\u724c\u4e2d\u7684"+t+"_"+n+"\uff0c\u79fb\u9664\u6570\u91cf:"+r);var g=this.findPengGangGroup(t,n);if(g&&g.exists)return console.warn("\u78b0\u6760\u533a"+t+"_"+n+"\u5df2\u7ecf\u6709\u7ec4\uff0c\u65e0\u6cd5\u6dfb\u52a0\u65b0\u7684\u6760"),void this.restoreMjToHand(t,n,r);for(var l=this.mjHandBox.children,p=0,f=0;f<l.length;f++){var d=l[f];d&&!1!==d.isValid&&(j=this.parseMjNodeName(d.name))&&j.type===t&&j.num===n&&p++}var m,v=this.mjPengGangBox.children,y=0;for(f=0;f<v.length;f++){var j;(j=this.parseMjNodeName(v[f].name))&&j.type===t&&j.num===n&&y++}if(c=p+y+4,(m=o.countTiles(this.mjHandBox,this.mjPengGangBox)).totalCount+3>14)return console.warn("\u6760\u724c\u540e\u603b\u5f20\u6570\u8d85\u8fc714\u5f20\uff0c\u65e0\u6cd5\u6760\u724c"),void this.restoreMjToHand(t,n,r);if(p>0)return console.warn("\u79fb\u9664\u624b\u724c\u540e\uff0c\u624b\u724c\u4e2d\u8fd8\u6709"+t+"_"+n+"\uff0c\u6570\u91cf:"+p+"\uff0c\u79fb\u9664\u64cd\u4f5c\u53ef\u80fd\u672a\u5b8c\u5168\u751f\u6548"),void this.restoreMjToHand(t,n,r);var M,G=y,B=G+4;if(B>4)return console.warn("\u6760\u724c\u540e"+t+"_"+n+"\u7684\u6570\u91cf\u8d85\u8fc74\u5f20\uff0c\u65e0\u6cd5\u6760\u724c (\u78b0\u6760:"+y+", \u5f53\u524d:"+G+", \u6dfb\u52a0\u540e:"+B+")"),void this.restoreMjToHand(t,n,r);if(!(M=o.getExistingSuits(this.mjHandBox,this.mjPengGangBox)).has(t)&&M.size>=2)return console.warn("\u6760\u724c\u540e\u82b1\u8272\u8d85\u8fc7\u4e24\u79cd\uff0c\u65e0\u6cd5\u6760\u724c"),void this.restoreMjToHand(t,n,r);this.addMjGroupToPengGangBox(t,n,4),console.log("\u6760\u724c\u6210\u529f: "+t+"_"+n+" (\u4ece\u624b\u724c\u79fb\u9664"+r+"\u5f20\uff0c\u4ece\u724c\u5806\u6dfb\u52a0\uff0c\u5728\u78b0\u6760\u533a\u6dfb\u52a04\u5f20)")}else{if(!o.validateAddTiles(this.mjHandBox,this.mjPengGangBox,t,n,4,!1))return void console.warn("\u6760\u724c\u9a8c\u8bc1\u5931\u8d25\uff1a\u53ef\u80fd\u8d85\u8fc7\u6570\u91cf\u9650\u5236\u6216\u82b1\u8272\u9650\u5236");this.addMjGroupToPengGangBox(t,n,4),console.log("\u6760\u724c\u6210\u529f:",t,n,"(\u4ece\u724c\u5806)")}this.checkGameState()},n.prototype.clickPengBtn=function(){var t=this.isWaitingForPeng;this.isWaitingForPeng=!t,this.isWaitingForPeng&&(this.isWaitingForGang=!1,this.setBtnHighlight(this.gangBtn,!1)),this.setBtnHighlight(this.pengBtn,this.isWaitingForPeng),this.isWaitingForPeng?console.log("\u7b49\u5f85\u9009\u62e9\u78b0\u724c..."):console.log("\u53d6\u6d88\u78b0\u724c\u9009\u62e9")},n.prototype.clickGangBtn=function(){var t=this.isWaitingForGang;this.isWaitingForGang=!t,this.isWaitingForGang&&(this.isWaitingForPeng=!1,this.setBtnHighlight(this.pengBtn,!1)),this.setBtnHighlight(this.gangBtn,this.isWaitingForGang),this.isWaitingForGang?console.log("\u7b49\u5f85\u9009\u62e9\u6760\u724c..."):console.log("\u53d6\u6d88\u6760\u724c\u9009\u62e9")},n.prototype.clickClearBtn=function(){if(this.mjPengGangBox.children.slice().forEach(function(t){t.destroy()}),this.mjPengGangBox){var t=this.mjPengGangBox.getContentSize();this.mjPengGangBox.setContentSize(0,t.height||100)}this.mjHandBox&&(this.mjHandBox.children.slice().forEach(function(t){t.destroy()}),this.isWaitingForPeng=!1,this.isWaitingForGang=!1,this.setBtnHighlight(this.pengBtn,!1),this.setBtnHighlight(this.gangBtn,!1),this.initInfo(),console.log("\u6e05\u7a7a\u5b8c\u6210"))},n.PRESS_SCALE=.85,n.PENG_GANG_SPACING=10,n.GANG_OVERLAP_OFFSET=15,r([c(cc.Node)],n.prototype,"tiaoBox",void 0),r([c(cc.Node)],n.prototype,"wanBox",void 0),r([c(cc.Node)],n.prototype,"tongBox",void 0),r([c(cc.Node)],n.prototype,"mjHandBox",void 0),r([c(cc.Node)],n.prototype,"mjPengGangBox",void 0),r([c(cc.Node)],n.prototype,"pengBtn",void 0),r([c(cc.Node)],n.prototype,"gangBtn",void 0),r([c(cc.Node)],n.prototype,"clearBtn",void 0),r([c(cc.RichText)],n.prototype,"tingInfo",void 0),r([c(cc.Label)],n.prototype,"cardNum",void 0),e=r([u],n)}(cc.Component);e.default=h,cc._RF.pop()},{"./MJManager":"MJManager"}],MJManager:[function(t,n,e){"use strict";cc._RF.push(n,"32710kDxGFCBbeszKyJtdid","MJManager");var o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.MJType=void 0,function(t){t[t.TIAO=0]="TIAO",t[t.WAN=1]="WAN",t[t.TONG=2]="TONG"}(e.MJType||(e.MJType={}));var i=function(){function t(){}return t.getInstance=function(){return null===t.instance&&(t.instance=new t),t.instance},t.prototype.parseMjNodeName=function(t){var n=t.match(/mj_(\d+)_(\d+)/);return n?{type:parseInt(n[1]),num:parseInt(n[2])}:null},t.prototype.countTiles=function(n,e){for(var o=new Map,i=0,r=n.children,a=0;a<r.length;a++){var s=r[a];if(p=this.parseMjNodeName(s.name)){var u=p.type+"_"+p.num,c=o.get(u)||0;o.set(u,c+1),i++}}var h=e.children;if(h.length>0){var g=[],l=null;for(a=0;a<h.length;a++){var p;s=h[a],(p=this.parseMjNodeName(s.name))&&(l&&l.type===p.type&&l.num===p.num?l.count++:(l&&g.push(l),l={type:p.type,num:p.num,count:1}))}l&&g.push(l);for(var f=0,d=g;f<d.length;f++){var m=d[f],v=(u=m.type+"_"+m.num,o.get(u)||0);4===m.count?(o.set(u,v+3),i+=3):(o.set(u,v+m.count),i+=m.count)}}var y=!0;o.forEach(function(n){n>t.MAX_TILE_COUNT&&(y=!1)}),i>t.MAX_TOTAL_COUNT&&(y=!1);var j="invalid";return y&&(13===i?j="ting":14===i&&(j="da")),{totalCount:i,tileCountMap:o,isValid:y,mode:j}},t.prototype.getExistingSuits=function(t,n){for(var e=new Set,o=t.children,i=0;i<o.length;i++){var r=o[i];(s=this.parseMjNodeName(r.name))&&e.add(s.type)}var a=n.children;for(i=0;i<a.length;i++){var s;r=a[i],(s=this.parseMjNodeName(r.name))&&e.add(s.type)}return e},t.prototype.validateAddTile=function(n,e,o,i){var r=this.countTiles(n,e);if(r.totalCount>=t.MAX_TOTAL_COUNT)return!1;for(var a=0,s=this.getPengGangGroups(e);a<s.length;a++){var u=s[a];if(u.type===o&&u.num===i){if(u.isGang)return!1;if(3===u.count){var c=o+"_"+i;if((r.tileCountMap.get(c)||0)-3>=1)return!1}break}}var h=o+"_"+i;if((r.tileCountMap.get(h)||0)>=t.MAX_TILE_COUNT)return!1;var g=this.getExistingSuits(n,e);return!(!g.has(o)&&g.size>=2)},t.prototype.validateAddTiles=function(n,e,o,i,r,a){var s=this.countTiles(n,e),u=a?r-1:r;if(s.totalCount+u>t.MAX_TOTAL_COUNT)return!1;var c=o+"_"+i,h=s.tileCountMap.get(c)||0;if((a?h+(r-1):h+r)>t.MAX_TILE_COUNT)return!1;var g=this.getExistingSuits(n,e);return!(!g.has(o)&&g.size>=2)},t.prototype.tileCountMapToArray=function(t){var n=[[],[],[]];t.forEach(function(t,e){var o=e.split("_"),i=o[0],r=o[1],a=parseInt(i),s=parseInt(r);n[a]||(n[a]=[]),n[a][s]=t});for(var e=0;e<3;e++){n[e]||(n[e]=[]);for(var o=1;o<=9;o++)n[e][o]||(n[e][o]=0)}return n},t.prototype.isQiXiaoDui=function(t){for(var n=0,e=0;e<3;e++)for(var o=1;o<=9;o++){var i=t[e][o]||0;if(2===i)n++;else if(0!==i&&2!==i)return!1}return 7===n},t.prototype.isLongQiDui=function(t){for(var n=0,e=!1,o=0;o<3;o++)for(var i=1;i<=9;i++){var r=t[o][i]||0;if(2===r)n++;else if(4===r)n+=2,e=!0;else if(0!==r)return!1}return 7===n&&e},t.prototype.isQingYiSe=function(t){for(var n=0,e=0;e<3;e++){for(var o=!1,i=1;i<=9;i++)if((t[e][i]||0)>0){o=!0;break}o&&n++}return 1===n},t.prototype.isJiangDui=function(t){for(var n=[2,5,8],e=0;e<3;e++)for(var o=1;o<=9;o++)if((t[e][o]||0)>0&&-1===n.indexOf(o))return!1;return!0},t.prototype.isDaDuiHu=function(t){for(var n=0,e=0,o=0;o<3;o++)for(var i=1;i<=9;i++){var r=t[o][i]||0;if(2===r)n++;else if(3===r||4===r)e++;else if(1===r)return!1}return 1===n&&4===e},t.prototype.canWinRecursive=function(t,n){for(var e=!0,o=0;o<3;o++){for(var i=1;i<=9;i++)if((t[o][i]||0)>0){e=!1;break}if(!e)break}if(e)return!n;if(n){for(o=0;o<3;o++)for(i=1;i<=9;i++)if((t[o][i]||0)>=2&&((r=this.copyTileArray(t))[o][i]-=2,this.canWinRecursive(r,!1)))return!0;return!1}for(o=0;o<3;o++)for(i=1;i<=9;i++)if((t[o][i]||0)>=3&&((r=this.copyTileArray(t))[o][i]-=3,this.canWinRecursive(r,!1)))return!0;for(o=0;o<3;o++)for(i=1;i<=7;i++){var r;if((t[o][i]||0)>0&&(t[o][i+1]||0)>0&&(t[o][i+2]||0)>0&&((r=this.copyTileArray(t))[o][i]--,r[o][i+1]--,r[o][i+2]--,this.canWinRecursive(r,!1)))return!0}return!1},t.prototype.copyTileArray=function(t){for(var n=[[],[],[]],e=0;e<3;e++){n[e]=[];for(var o=1;o<=9;o++)n[e][o]=t[e][o]||0}return n},t.prototype.isQueYiMen=function(t){for(var n=0,e=0;e<3;e++){for(var o=!1,i=1;i<=9;i++)if((t[e][i]||0)>0){o=!0;break}o&&n++}return n<=2},t.prototype.canWin=function(t,n,e){var o=this.tileCountMapToArray(t);if(!this.isQueYiMen(o))return!1;if(n&&e&&e.children.length>0){for(var i=this.getPengGangGroups(e),r=new Map,a=0,s=i;a<s.length;a++){var u=s[a],c=u.type+"_"+u.num,h=4===u.count?3:u.count;r.set(c,h)}var g=new Map;t.forEach(function(t,n){var e=t-(r.get(n)||0);e>0&&g.set(n,e)});var l=this.tileCountMapToArray(g);return this.canWinRecursive(l,!0)}return!!this.isQiXiaoDui(o)||!!this.isLongQiDui(o)||this.canWinRecursive(o,!0)},t.prototype.getSuitNameForPattern=function(t){for(var n=["\u6761","\u4e07","\u7b52"],e=0;e<3;e++){for(var o=!1,i=1;i<=9;i++)if((t[e][i]||0)>0){o=!0;break}if(o)return n[e]}return""},t.prototype.calculateFan=function(t,n,e,o,i){for(var r=this.tileCountMapToArray(t),a=[],s=this.isQingYiSe(r),u=this.isDaDuiHu(r),c=this.isQiXiaoDui(r),h=this.isLongQiDui(r),g=this.isJiangDui(r),l=this.getSuitNameForPattern(r),p=0,f=0,d=this.getPengGangGroups(e);f<d.length;f++)d[f].isGang&&p++;p>0||this.hasGang(n,e,t,o,i);var m=1,v="";this.isJinGouDiao(n)?s?(m=16,v=l+"\u6e05\u4e00\u8272\u91d1\u94a9\u9493"):(m=4,v="\u91d1\u94a9\u9493"):s&&c?(m=16,v=l+"\u6e05\u4e00\u8272\u4e03\u5c0f\u5bf9"):s&&u?(m=8,v=l+"\u6e05\u5bf9"):u&&g?(m=8,v="\u5c06\u5bf9"):h?(m=8,v="\u9f99\u4e03\u5bf9"):s?(m=4,v=l+"\u6e05\u4e00\u8272"):c?(m=4,v="\u4e03\u5c0f\u5bf9"):u?(m=2,v="\u5927\u5bf9"):(m=1,v="");for(var y=m,j=0;j<p;j++)y*=2;return a.push({fan:y,pattern:v}),a.sort(function(t,n){return n.fan-t.fan}),a},t.prototype.countPengGangGroups=function(t){var n=t.children;if(0===n.length)return 0;for(var e=[],o=null,i=0;i<n.length;i++){var r=n[i],a=this.parseMjNodeName(r.name);a&&(o&&o.type===a.type&&o.num===a.num?o.count++:(o&&e.push(o),o={type:a.type,num:a.num,count:1}))}return o&&e.push(o),e.length},t.prototype.getPengGangGroups=function(t){var n=t.children;if(0===n.length)return[];for(var e=[],i=null,r=0;r<n.length;r++){var a=n[r],s=this.parseMjNodeName(a.name);s&&(i&&i.type===s.type&&i.num===s.num?i.count++:(i&&e.push(i),i={type:s.type,num:s.num,count:1}))}return i&&e.push(i),e.map(function(t){return o(o({},t),{isGang:4===t.count})})},t.prototype.hasGang=function(t,n,e,o,i){for(var r=0,a=this.getPengGangGroups(n);r<a.length;r++)if(a[r].isGang)return!0;for(var s=t.children,u=new Map,c=0;c<s.length;c++){var h=this.parseMjNodeName(s[c].name);if(h){var g=h.type+"_"+h.num;u.set(g,(u.get(g)||0)+1)}}var l=Array.from(u.values());for(c=0;c<l.length;c++)if(l[c]>=4)return!0;if(void 0!==o&&void 0!==i){var p=o+"_"+i;if((e.get(p)||0)>=4)return!0}return!1},t.prototype.isJinGouDiao=function(t){return 1===t.children.length},t.prototype.calculateTing=function(t,n){var e=this.countTiles(t,n);if(13!==e.totalCount||!e.isValid)return[];for(var o=[],i=this.getExistingSuits(t,n),r=(this.countPengGangGroups(n),0);r<3;r++)if(2!==i.size||i.has(r))for(var a=1;a<=9;a++){for(var s=!1,u=0,c=this.getPengGangGroups(n);u<c.length;u++){var h=c[u];if(h.type===r&&h.num===a&&h.isGang){s=!0;break}}if(!s){var g=r+"_"+a,l=e.tileCountMap.get(g)||0;if(!(l>=4)){var p=new Map(e.tileCountMap);if(p.set(g,l+1),this.canWin(p,t,n))for(var f=4-l,d=0,m=this.calculateFan(p,t,n,r,a);d<m.length;d++){var v=m[d];o.push({type:r,num:a,score:v.fan,pattern:v.pattern,remainingCount:f})}}}}return o},t.prototype.createTestHandBox=function(t,n,e){var o=new cc.Node;o.name="testHandBox";for(var i=t.children,r=!1,a=0;a<i.length;a++){var s=i[a];if(s&&!1!==s.isValid){var u=this.parseMjNodeName(s.name);if(u)if(r||u.type!==n||u.num!==e){var c=new cc.Node;c.name=s.name,o.addChild(c)}else r=!0}}return o},t.prototype.calculateDiscardRecommendation=function(t,n){var e=this,o=this.countTiles(t,n);if(14!==o.totalCount||!o.isValid)return[];for(var i=[],r=new Set,a=t.children,s=0;s<a.length;s++){var u=a[s];if(u&&!1!==u.isValid){var c=this.parseMjNodeName(u.name);if(c){var h=c.type+"_"+c.num;r.add(h)}}}return r.forEach(function(o){var r=o.split("_"),a=r[0],s=r[1],u=parseInt(a),c=parseInt(s),h=e.countTiles(t,n),g=u+"_"+c,l=h.tileCountMap.get(g)||0,p=0;if(l>=2&&(p-=1e3),1===l){var f=!1;if(c>=2){var d=u+"_"+(c-1);(h.tileCountMap.get(d)||0)>0&&(f=!0)}if(c<=8){var m=u+"_"+(c+1);(h.tileCountMap.get(m)||0)>0&&(f=!0)}if(f){var v=0;c>=2&&(d=u+"_"+(c-1),(h.tileCountMap.get(d)||0)>0&&v++),c<=8&&(m=u+"_"+(c+1),(h.tileCountMap.get(m)||0)>0&&v++),p-=500*v}else p+=500}var y=e.createTestHandBox(t,u,c);if(y){var j=e.calculateTing(y,n);if(0===j.length){for(var M=e.countTiles(y,n),G=0,B=y.children,_=new Map,x=0;x<B.length;x++)if((w=B[x])&&!1!==w.isValid){var N=e.parseMjNodeName(w.name);if(N){var T=N.type+"_"+N.num;_.set(T,(_.get(T)||0)+1)}}for(var C=0,P=0;P<3;P++)for(var A=1;A<=9;A++){var H=P+"_"+A;if(!((M.tileCountMap.get(H)||0)>=4)){var F=new cc.Node;for(F.name="tempHandBox",x=0;x<B.length;x++){var w;if((w=B[x])&&!1!==w.isValid){var E=new cc.Node;E.name=w.name,F.addChild(E)}}var S=new cc.Node;S.name="mj_"+P+"_"+A,F.addChild(S);var I=e.calculateTing(F,n);I.length>C&&(C=I.length),F.destroy()}}var O=0,b=0,D=0;_.forEach(function(t){1===t?b++:2===t?O++:t>=3&&D++});var W=new Set;return _.forEach(function(t,n){if(t>0){var e=n.split("_")[0],o=parseInt(e);W.add(o)}}),G=1e3*C,G=1e3*C+p,1===W.size&&(G+=500),O>=5&&(G+=300),D>=3&&(G+=200),G-=10*b,G+=20*O,i.push({type:u,num:c,score:G,tingCount:0,totalTingScore:0,avgTingScore:0,maxRemainingCount:C}),void y.destroy()}var k=j.length,R=j.reduce(function(t,n){return t+n.score},0),J=k>0?R/k:0,z=j.length>0?Math.max.apply(Math,j.map(function(t){return t.score})):0,L=j.length>0?Math.max.apply(Math,j.map(function(t){return t.remainingCount})):0,V=1e4*k+100*z+1*R+5*J+2*L;i.push({type:u,num:c,score:V,tingCount:k,totalTingScore:R,avgTingScore:J,maxRemainingCount:L}),y.destroy()}}),i.sort(function(t,n){return n.score-t.score}),i},t.instance=null,t.MAX_TOTAL_COUNT=14,t.MAX_TILE_COUNT=4,t}();e.default=i,cc._RF.pop()},{}]},{},["MJHu","MJManager"]);